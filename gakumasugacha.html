<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ガチャルーレット</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
      background: #f5f5f5;
      border: 2px solid #333;
      padding: 20px;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      position: absolute;
      top: 20px;
    }

    .wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
      border: 2px solid #333;
      border-radius: 50%;
    }

    .pointer {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%) rotate(180deg);
      font-size: 2.5rem;
      color: red;
      z-index: 10;
    }

    svg {
      width: 100%;
      height: 100%;
      transform: rotate(0deg);
      transition: transform 3s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: block;
      border-radius: 50%;
    }

    path {
      stroke: #333;
      stroke-width: 1;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1.2rem;
      background-color: #00c853;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      font-size: 1.5rem;
      padding: 10px;
    }

    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>誰を育成する？</h1>

  <div class="wheel-container">
    <div class="pointer">▲</div>
    <svg id="wheel" viewBox="0 0 200 200">
      <circle cx="100" cy="100" r="100" fill="none" stroke="#333" stroke-width="2"/>
      <g id="segments"></g>
    </svg>
  </div>

  <button id="spinButton">この子！</button>
  <div id="result"></div>

  <audio id="gongSound" src="教会の鐘1.mp3" preload="auto"></audio>

  <script>
    const outcomes = [
      '花海咲季', '月村手毬', '藤田ことね', '有村麻央', '葛城リーリヤ',
      '倉本千奈', '紫雲清夏', '篠澤広', '姫崎莉波', '花海佑芽',
      '秦谷美鈴', '十王星南', '雨夜燕'
    ];
    const segmentAngle = 360 / outcomes.length;
    const segments = document.getElementById('segments');
    const wheel = document.getElementById('wheel');
    const button = document.getElementById('spinButton');
    const result = document.getElementById('result');
    const gong = document.getElementById('gongSound');
    let currentRotation = 0;

    function getSecureRandom360() {
      const array = new Uint32Array(1);
      crypto.getRandomValues(array);
      return array[0] / 0xFFFFFFFF * 360;
    }

    outcomes.forEach((name, index) => {
      const startAngle = segmentAngle * index;
      const endAngle = startAngle + segmentAngle;
      const x1 = 100 + 100 * Math.cos((startAngle - 90) * (Math.PI / 180));
      const y1 = 100 + 100 * Math.sin((startAngle - 90) * (Math.PI / 180));
      const x2 = 100 + 100 * Math.cos((endAngle - 90) * (Math.PI / 180));
      const y2 = 100 + 100 * Math.sin((endAngle - 90) * (Math.PI / 180));

      const randomColor = `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`;

      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('d', `M100,100 L${x1},${y1} A100,100 0 0,1 ${x2},${y2} Z`);
      path.setAttribute('fill', randomColor);
      segments.appendChild(path);

      const textAngle = ((startAngle + endAngle) / 2 - 90);
      const textX = 100 + 65 * Math.cos(textAngle * Math.PI / 180);
      const textY = 100 + 65 * Math.sin(textAngle * Math.PI / 180);

      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', textX);
      text.setAttribute('y', textY);
      text.setAttribute('font-size', '8');
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('alignment-baseline', 'middle');
      text.setAttribute('fill', '#fff');
      text.setAttribute('transform', `rotate(${textAngle}, ${textX}, ${textY})`);
      text.textContent = name;
      segments.appendChild(text);
    });

    button.addEventListener('click', () => {
      button.disabled = true;
      const spin = 360 * 5 + getSecureRandom360();
      currentRotation += spin;
      wheel.style.transition = 'transform 3s cubic-bezier(0.25, 0.8, 0.25, 1)';
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      setTimeout(() => {
        const selectedIndex = Math.floor((360 - (currentRotation % 360)) / segmentAngle) % outcomes.length;
        result.textContent = `育成するキャラは「${outcomes[selectedIndex]}」！`;
        gong.currentTime = 0;
        gong.play();
        button.disabled = false;
      }, 3000);
    });
  </script>
</body>
</html>
